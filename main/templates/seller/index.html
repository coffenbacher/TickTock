{% extends 'base.html' %}

{% block includes %}
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script type="text/javascript" src="/static/js/gmaps.js"></script>
<script type="text/javascript" src="/static/js/maptips.js"></script>
<script type="text/javascript">
    var map;
     var slugify = function(s){
        return s.replace(/\s/g, '_');
     };
     var update = function(){
          map.removeMarkers();
          $.get(window.location.pathname+'?json=y', function(data){
            var d = eval('('+data+')');
            var image = "http://www.google.com/intl/en_us/mapfiles/ms/micons/green-dot.png";
            for (s in d){
                if (d[s].location__lat && d[s].location__lng){
                    if (d[s].sellerconfirmation__confirm)
                        icon = image;
                    else
                        icon = '';
                    marker = map.addMarker({
                        lat: d[s].location__lat,
                        lng: d[s].location__lng,
                        icon: icon,
                        title: d[s].name,
                        click: function(e) { 
                            window.location.href = '/seller/'+slugify(this.title);
                        }
                    });
                }
            }
          });
     };
    $(document).ready(function(){

      map = new GMaps({
        div: '#map',
        lat: {{ center_lat }}, 
        lng: {{ center_lng }},
        zoom: {{ zoom }},
      });
      update();

    });
</script>

{% endblock %}

{% block content %}
    <div class="container">
        <div class="row">
            <div id="map" style="height:500px" class="span12"></div>
        </div>
        <hr />
        {% if options %}
        <div class="row">
            <h2>Browse by {{ option_level.label }}</h2>
            <ol>
            {% for o in options %}
                <li><a href="/seller/{{ option_level.url }}/{{ o.0 }}/">{{ o.0 }} - {{ o.1 }}</a></li>
            {% endfor %}
            </ol>
        </div>
        {% endif %}

        <div class="row">
            {% if selected %}<h2>Luthiers in {{ selected }}</h2>{% endif %}
            {% for i in s %}
            
            <div class="span4">
                <a href="/seller/{{ i.slugify }}">
                <div class="instrument">
                    <h3>{{ i.name }}</h3>
                    <!--<h4>{{ i.subtitle }}</h4>-->
                    <i>{{i.location.formatted_address }} </i>
                </div>
                </a>
            </div>

            {% if forloop.counter|divisibleby:"3" %}
                </div><div class="row">
            {% endif %}
            {% endfor %}

        </div>
    </div>
{% endblock %}

